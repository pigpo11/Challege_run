generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id               String    @id @default(cuid())
  email            String    @unique
  password         String
  name             String
  profilePic       String?
  statusMessage    String?   @default("Ïò§ÎäòÎèÑ Ï¶êÍ≤ÅÍ≤å Îã¨Î†§Ïöî! üèÉ‚Äç‚ôÇÔ∏è")
  monthlyDistance  Float     @default(0)
  monthlyGoal      Float     @default(100)
  totalScore       Int       @default(0)
  lastUpdatedMonth Int       @default(1)
  role             String    @default("USER") // USER, LEADER
  
  groupId          String?
  group            Group?    @relation(fields: [groupId], references: [id])
  
  teamId           String?
  team             Team?     @relation(fields: [teamId], references: [id])
  
  missions         Mission[]
  comments         Comment[]
  
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  pb1km            String?
  pb3km            String?
  pb5km            String?
  pb10km           String?
}

model Group {
  id            String    @id @default(cuid())
  name          String
  inviteCode    String    @unique
  totalScore    Int       @default(0)
  totalDistance Float     @default(0)
  
  members       User[]
  teams         Team[]
  missions      Mission[]
  
  createdAt     DateTime  @default(now())
}

model Team {
  id        String    @id @default(cuid())
  name      String
  groupId   String
  group     Group     @relation(fields: [groupId], references: [id])
  
  members   User[]
  missions  Mission[]
  
  createdAt DateTime  @default(now())
}

model Mission {
  id        String   @id @default(cuid())
  type      String   // 'Í∞úÏù∏ Îü¨Îãù', 'Ï±åÎ¶∞ÏßÄ Ïù∏Ï¶ù'
  status    String   // 'pending', 'approved', 'none'
  week      Int
  distance  Float    @default(0)
  timestamp String?
  images    String[]
  records   Json?    // Store 1km, 3km times etc.
  
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  groupId   String?
  group     Group?    @relation(fields: [groupId], references: [id])
  
  teamId    String?
  team      Team?     @relation(fields: [teamId], references: [id])
  
  likes     String[] // Array of user names or IDs who liked
  comments  Comment[]
  
  createdAt DateTime @default(now())
}

model Comment {
  id        String   @id @default(cuid())
  text      String
  timestamp String?
  
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  missionId String
  mission   Mission  @relation(fields: [missionId], references: [id])
  
  createdAt DateTime @default(now())
}

model Challenge {
  id           String @id @default(cuid())
  week         Int    @unique
  title        String
  description  String
  recordFields Json?  // Store fields like {id, label, unit}
}
